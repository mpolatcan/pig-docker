ARG JAVA_VERSION=8
ARG HADOOP_VERSION=3.2.1

FROM mpolatcan/hadoop:${HADOOP_VERSION}-java${JAVA_VERSION}

MAINTAINER Mutlu Polatcan <mutlupolatcan@gmail.com>

ENV PIG_HOME "${HDUSER_HOME}/pig"
ENV PIG_CONF_DIR="${PIG_HOME}/conf" \
    PATH=$PATH:$PIG_HOME/bin \
	AGGREGATE_WARNING="true" \
	BRIEF="false" \
	DEBUG="INFO" \
	EXECTYPE="mapreduce" \
	FILE="NULL" \
	HCAT_BIN="NULL" \
	JAR="NULL" \
	LOG4JCONF="" \
	OPT_MULTIQUERY="true" \
	OPT_FETCH="true" \
	PIG_CACHEDBAG_MEMUSAGE="0.2" \
	PIG_SKEWEDJOIN_REDUCE_MEMUSAGE="0.3" \
	PIG_EXEC_NOCOMBINER="false" \
	PIG_EXEC_NOCOMBINER_REDUCER="auto" \
	PIG_EXEC_MAPPARTAGG="false" \
	PIG_EXEC_MAPPARTAGG_MINREDUCTION="10" \
	PIG_EXEC_REDUCERS_BYTES_PER_REDUCER="1000000000" \
	PIG_EXEC_REDUCERS_MAX="999" \
	PIG_EXEC_REDUCER_ESTIMATOR="NULL" \
	PIG_EXEC_REDUCER_ESTIMATOR_ARG="NULL" \
	PIG_TMPFILECOMPRESSION="NULL" \
	PIG_TMPFILECOMPRESSION_CODEC="gzip" \
	PIG_TMPFILECOMPRESSION_STORAGE="tfile" \
	PIG_NOSPLITCOMBINATION="NULL" \
	PIG_ADDITIONAL_JARS_URIS="NULL" \
	PIG_DATETIME_DEFAULT_TZ="NULL" \
	PIG_ARTIFACTS_DOWNLOAD_LOCATION="~/.groovy/grapes" \
	PIG_USER_CACHE_ENABLED="false" \
	PIG_USER_CACHE_LOCATION="/tmp" \
	PIG_USER_CACHE_REPLICATION="10" \
	PIG_SPILL_SIZE_THRESHOLD="5000000" \
	PIG_SPILL_GC_ACTIVATION_SIZE="NULL" \
	PIG_SPILL_MEMORY_USAGE_THRESHOLD_FRACTION="0.7" \
	PIG_SPILL_COLLECTION_THRESHOLD_FRACTION="0.7" \
	PIG_SPILL_UNUSED_MEMORY_THRESHOLD_SIZE="367001600" \
	PIG_JOIN_REPLICATED_MAX_BYTES="1000000000" \
	PIG_SCHEMATUPLE="false" \
	PIG_SCHEMATUPLE_UDF="false" \
	PIG_SCHEMATUPLE_LOAD="false" \
	PIG_SCHEMATUPLE_FR_JOIN="false" \
	PIG_SCHEMATUPLE_MERGE_JOIN="false" \
	PIG_OUTPUT_LAZY="false" \
	PIG_OUTPUT_COMMITTER_RECOVERY_SUPPORT="true" \
	PIG_TEZ_AUTO_PARALLELISM="true" \
	PIG_TEZ_GRACE_PARALLELISM="true" \
	PIG_TEZ_OPT_UNION_UNSUPPORTED_STOREFUNCS="org.apache.hcatalog.pig.HCatStorer,org.apache.hive.hcatalog.pig.HCatStorer" \
	PIG_TEZ_OPT_UNION_SUPPORTED_STOREFUNCS="NULL" \
	PIG_TEZ_CONFIGURE_AM_MEMORY="false" \
	PIG_PRETTY_PRINT_SCHEMA="false" \
	PIG_UDF_PROFILE="false" \
	PIG_UDF_PROFILE_FREQUENCY="100" \
	PIG_LOAD_DEFAULT_STATEMENTS="NULL" \
	PIG_LOGFILE="NULL" \
	PIG_STATS_OUTPUT_SIZE_READER="NULL" \
	PIG_STATS_OUTPUT_SIZE_READER_UNSUPPORTED="NULL" \
	PIG_STREAMING_ENVIRONMENT="NULL" \
	PIG_STREAMING_SHIP_FILES="NULL" \
	PIG_STREAMING_CACHE_FILES="NULL" \
	PIG_STREAMING_UDF_PYTHON_COMMAND="python" \
	PIG_DISABLE_COUNTER="true" \
	PIG_SCRIPT_MAX_SIZE="10240" \
	PIG_ERROR_HANDLING_ENABLED="false" \
	PIG_ERROR_HANDLING_MIN_ERROR_RECORDS="0" \
	PIG_ERROR_HANDLING_ERROR_THRESHOLD="0.0f" \
	PIG_RANDOM_SAMPLER_SAMPLE_SIZE="100" \
	PIG_MAXCOMBINEDSPLITSIZE="NULL" \
	PIG_AUTO_LOCAL_ENABLED="false" \
	PIG_AUTO_LOCAL_INPUT_MAXBYTES="100000000" \
	PIG_BLACKLIST="NULL" \
	PIG_WHITELIST="NULL" \
	PIG_NOTIFIACTION_LISTENER="NULL" \
	PIG_NOTIFIACTION_LISTENER_ARG="NULL" \
	PIG_DEFAULT_LOAD_FUNC="NULL" \
	PIG_DEFAULT_STORE_FUNC="NULL" \
	PIG_ATS_ENABLED="true" \
	PIG_SQL_TYPE="hcat" \
	PIG_LOCATION_CHECK_STRICT="false" \
	PIG_DELETE_TEMP_FILES="true" \
	PIG_BZIP_USE_HADOOP_INPUTFORMAT="true" \
	PIG_USE_OVERRIDEN_HADOOP_CONFIGS="false" \
	PIG_SORT_READONCE_LOADFUNCS="NULL" \
	STOP_ON_FAILURE="false" \
	UDF_IMPORT_LIST="NULL" \
	VERBOSE="false"

ADD entrypoint.sh ${HDUSER_HOME}/pig_entrypoint.sh
ADD config_loader.sh ${HDUSER_HOME}/pig_config_loader.sh

USER root
RUN mkdir -p ${PIG_HOME} && \
    chmod +x ${HDUSER_HOME}/pig_config_loader.sh ${HDUSER_HOME}/pig_entrypoint.sh
